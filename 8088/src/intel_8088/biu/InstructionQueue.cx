/*
 * Copyright (c) 2015 Matthieu
 * All rights reserved.
 */
package intel_8088.biu;

task InstructionQueue {

	u8 queue[4];
	u3 count;

	in sync ready u8 instr_in;
	out sync ready u8 instr;

	void do_write() {
		instr.write(queue[0]);
		for (u3 i = 0; i < 3; i++) {
			queue[i] = queue[i + 1];
		}
		
		count--;
	}

	void loop() {
		if (count == 4) {
			do_write();
		} else {
			queue[count] = instr_in.read();
			count++;
			if (instr.ready) { 
				do_write();
			}
		}
	}

}
